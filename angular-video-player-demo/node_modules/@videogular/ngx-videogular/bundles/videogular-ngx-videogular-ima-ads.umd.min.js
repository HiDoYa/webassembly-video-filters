!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@angular/core"),require("@angular/common"),require("@videogular/ngx-videogular/core")):"function"==typeof define&&define.amd?define("@videogular/ngx-videogular/ima-ads",["exports","@angular/core","@angular/common","@videogular/ngx-videogular/core"],e):e(((t="undefined"!=typeof globalThis?globalThis:t||self).videogular=t.videogular||{},t.videogular["ngx-videogular"]=t.videogular["ngx-videogular"]||{},t.videogular["ngx-videogular"]["ima-ads"]={}),t.ng.core,t.ng.common,t.videogular["ngx-videogular"].core)}(this,(function(t,e,i,n){"use strict";var o=function(){function t(t,i,n){this.API=i,this.fsAPI=n,this.vgSkipButtonLocale="en",this.onAdStart=new e.EventEmitter,this.onAdStop=new e.EventEmitter,this.onSkipAd=new e.EventEmitter,this.isFullscreen=!1,this.subscriptions=[],this.displayState="none",this.elem=t.nativeElement,this.onContentEnded=this.onContentEnded.bind(this)}return t.prototype.ngOnInit=function(){var t=this;this.API.isPlayerReady?this.onPlayerReady():this.subscriptions.push(this.API.playerReadyEvent.subscribe((function(){return t.onPlayerReady()})))},t.prototype.onPlayerReady=function(){"undefined"!=typeof google?(this.target=this.API.getMediaById(this.vgFor),this.initializations(),this.subscriptions.push(this.target.subscriptions.ended.subscribe(this.onContentEnded.bind(this))),this.subscriptions.push(this.target.subscriptions.play.subscribe(this.onUpdateState.bind(this))),this.subscriptions.push(this.fsAPI.onChangeFullscreen.subscribe(this.onChangeFullscreen.bind(this))),this.ima.adsLoader.addEventListener(google.ima.AdsManagerLoadedEvent.Type.ADS_MANAGER_LOADED,this.onAdsManagerLoaded.bind(this),!1),this.ima.adsLoader.addEventListener(google.ima.AdErrorEvent.Type.AD_ERROR,this.onAdError.bind(this),!1),this.loadAds()):this.onMissingGoogleImaLoader()},t.prototype.initializations=function(){var t=this;this.ima=new s(this.elem,this.vgSkipButtonLocale),this.vgSkipButton&&(this.skipButton=document.querySelector(this.vgSkipButton),this.skipButton.style.display="none",this.skipButton.addEventListener("click",this.onClickSkip.bind(this)),this.elem.insertBefore(this.skipButton,this.elem.firstChild)),window.addEventListener("resize",(function(){var e=t.API.videogularElement.offsetWidth,i=t.API.videogularElement.offsetHeight;t.ima.adsManager&&(t.isFullscreen?t.ima.adsManager.resize(e,i,google.ima.ViewMode.FULLSCREEN):t.ima.adsManager.resize(e,i,google.ima.ViewMode.NORMAL))}))},t.prototype.loadAds=function(){var t=this;this.vgCompanion&&googletag.cmd.push((function(){var e="/"+t.vgNetwork+"/"+t.vgUnitPath,i=googletag.defineSlot(e,t.vgCompanionSize,t.vgCompanion);i&&(i.addService(googletag.companionAds()),i.addService(googletag.pubads()),googletag.companionAds().setRefreshUnfilledSlots(!0),googletag.pubads().enableVideoAds(),googletag.enableServices())}))},t.prototype.onUpdateState=function(t){switch(t.type){case n.VgEvents.VG_PLAY:this.ima.adsLoaded||(this.API.pause(),this.ima.adDisplayContainer.initialize(),this.requestAds(this.vgAdTagUrl),this.ima.adsLoaded=!0)}},t.prototype.requestAds=function(t){this.show();var e=new google.ima.AdsRequest,i=window.getComputedStyle(this.elem);e.adTagUrl=t,e.linearAdSlotWidth=parseInt(i.width,10),e.linearAdSlotHeight=parseInt(i.height,10),e.nonLinearAdSlotWidth=parseInt(i.width,10),e.nonLinearAdSlotHeight=parseInt(i.height,10),this.ima.adsLoader.requestAds(e)},t.prototype.onAdsManagerLoaded=function(t){this.show(),this.ima.adsManager=t.getAdsManager(this.target),this.processAdsManager(this.ima.adsManager)},t.prototype.processAdsManager=function(t){var e=this.API.videogularElement.offsetWidth,i=this.API.videogularElement.offsetHeight;this.ima.adsManager.addEventListener(google.ima.AdEvent.Type.CONTENT_PAUSE_REQUESTED,this.onContentPauseRequested.bind(this),!1),this.ima.adsManager.addEventListener(google.ima.AdEvent.Type.CONTENT_RESUME_REQUESTED,this.onContentResumeRequested.bind(this),!1),this.ima.adsManager.addEventListener(google.ima.AdEvent.Type.SKIPPABLE_STATE_CHANGED,this.onSkippableStateChanged.bind(this),!1),this.ima.adsManager.addEventListener(google.ima.AdEvent.Type.ALL_ADS_COMPLETED,this.onAllAdsComplete.bind(this),!1),this.ima.adsManager.addEventListener(google.ima.AdEvent.Type.COMPLETE,this.onAdComplete.bind(this),!1),this.ima.adsManager.addEventListener(google.ima.AdErrorEvent.Type.AD_ERROR,this.onAdError.bind(this),!1),this.ima.adsManager.init(e,i,google.ima.ViewMode.NORMAL),this.ima.adsManager.start()},t.prototype.onSkippableStateChanged=function(){var t=this.ima.adsManager.getAdSkippableState();this.skipButton.style.display=t?"block":"none"},t.prototype.onClickSkip=function(){this.ima.adsManager.skip(),this.onSkipAd.emit(!0)},t.prototype.onContentPauseRequested=function(){this.show(),this.API.pause(),this.onAdStop.emit(!0)},t.prototype.onContentResumeRequested=function(){this.API.play(),this.onAdStart.emit(!0),this.hide()},t.prototype.onAdError=function(t){this.ima.adsManager&&this.ima.adsManager.destroy(),this.hide(),this.API.play(),this.onAdStop.emit(!0)},t.prototype.onAllAdsComplete=function(){this.hide(),this.ima.adsManager.getCuePoints().join().indexOf("-1")>=0&&(this.API.pause(),this.onAdStop.emit(!0))},t.prototype.onAdComplete=function(){this.ima.currentAd++,this.onAdStop.emit(!0)},t.prototype.show=function(){window.dispatchEvent(new CustomEvent(n.VgEvents.VG_START_ADS)),this.displayState="block"},t.prototype.hide=function(){window.dispatchEvent(new CustomEvent(n.VgEvents.VG_END_ADS)),this.displayState="none"},t.prototype.onContentEnded=function(){this.ima.adsLoader.contentComplete(),this.onAdStop.emit(!0)},t.prototype.onChangeFullscreen=function(t){this.fsAPI.nativeFullscreen||(this.isFullscreen=t)},t.prototype.onMissingGoogleImaLoader=function(){this.hide(),this.API.play()},t.prototype.ngOnDestroy=function(){this.subscriptions.forEach((function(t){return t.unsubscribe()}))},t}();o.decorators=[{type:e.Component,args:[{selector:"vg-ima-ads",encapsulation:e.ViewEncapsulation.None,template:'<div class="vg-ima-ads"></div>',styles:["\n      vg-ima-ads {\n        position: absolute;\n        width: 100%;\n        height: 100%;\n        z-index: 300;\n      }\n      vg-ima-ads .vg-ima-ads {\n        position: absolute;\n        width: 100%;\n        height: 100%;\n        pointer-events: none;\n      }\n    "]}]}],o.ctorParameters=function(){return[{type:e.ElementRef},{type:n.VgApiService},{type:n.VgFullscreenApiService}]},o.propDecorators={vgFor:[{type:e.Input}],vgNetwork:[{type:e.Input}],vgUnitPath:[{type:e.Input}],vgCompanion:[{type:e.Input}],vgCompanionSize:[{type:e.Input}],vgAdTagUrl:[{type:e.Input}],vgSkipButton:[{type:e.Input}],vgSkipButtonLocale:[{type:e.Input}],onAdStart:[{type:e.Output}],onAdStop:[{type:e.Output}],onSkipAd:[{type:e.Output}],displayState:[{type:e.HostBinding,args:["style.display"]}]};var s=function(t,e){(null===google||void 0===google?void 0:google.ima.settings)&&e&&google.ima.settings.setLocale(e),this.adDisplayContainer=new google.ima.AdDisplayContainer(t),this.adsLoader=new google.ima.AdsLoader(this.adDisplayContainer),this.adsManager=null,this.adsLoaded=!1,this.currentAd=0};var a=function(){};a.decorators=[{type:e.NgModule,args:[{imports:[i.CommonModule,n.VgCoreModule],declarations:[o],exports:[o]}]}],t.Ima=s,t.VgImaAdsComponent=o,t.VgImaAdsModule=a,Object.defineProperty(t,"__esModule",{value:!0})}));
//# sourceMappingURL=videogular-ngx-videogular-ima-ads.umd.min.js.map