!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@angular/core"),require("@angular/common"),require("@videogular/ngx-videogular/core")):"function"==typeof define&&define.amd?define("@videogular/ngx-videogular/streaming",["exports","@angular/core","@angular/common","@videogular/ngx-videogular/core"],e):e(((t="undefined"!=typeof globalThis?globalThis:t||self).videogular=t.videogular||{},t.videogular["ngx-videogular"]=t.videogular["ngx-videogular"]||{},t.videogular["ngx-videogular"].streaming={}),t.ng.core,t.ng.common,t.videogular["ngx-videogular"].core)}(this,(function(t,e,i,s){"use strict";var r=function(){function t(t,i){this.ref=t,this.API=i,this.onGetBitrates=new e.EventEmitter,this.subscriptions=[]}return t.prototype.ngOnInit=function(){var t=this;this.API.isPlayerReady?this.onPlayerReady():this.subscriptions.push(this.API.playerReadyEvent.subscribe((function(){return t.onPlayerReady()})))},t.prototype.onPlayerReady=function(){this.vgFor=this.ref.nativeElement.getAttribute("vgFor"),this.target=this.API.getMediaById(this.vgFor),this.createPlayer()},t.prototype.ngOnChanges=function(t){var e;(null===(e=t.vgDash)||void 0===e?void 0:e.currentValue)?this.createPlayer():this.destroyPlayer()},t.prototype.createPlayer=function(){var t=this;if(this.dash&&this.destroyPlayer(),this.vgDash&&(this.vgDash.indexOf(".mpd")>-1||this.vgDash.indexOf("mpd-time-csf")>-1)){var e=void 0;if(this.vgDRMLicenseServer&&(e=this.vgDRMLicenseServer,this.vgDRMToken))for(var i in e)i.hasOwnProperty(i)&&(e[i].httpRequestHeaders={Authorization:this.vgDRMToken});this.dash=dashjs.MediaPlayer().create(),this.dash.updateSettings({debug:{logLevel:dashjs.Debug.LOG_LEVEL_NONE}}),this.dash.initialize(this.ref.nativeElement),this.dash.setAutoPlay(!1),this.dash.on(dashjs.MediaPlayer.events.STREAM_INITIALIZED,(function(){var e=t.dash.getBitrateInfoListFor("audio"),i=t.dash.getBitrateInfoListFor("video");e.length>1&&(e.forEach((function(t){return t.qualityIndex=++t.qualityIndex})),e.unshift({qualityIndex:0,width:0,height:0,bitrate:0,mediaType:"video",scanType:"AUTO"}),t.onGetBitrates.emit(e)),i.length>1&&(i.forEach((function(t){return t.qualityIndex=++t.qualityIndex})),i.unshift({qualityIndex:0,width:0,height:0,bitrate:0,mediaType:"video",scanType:"AUTO"}),t.onGetBitrates.emit(i))})),e&&this.dash.setProtectionData(e),this.dash.attachSource(this.vgDash)}else this.target&&(this.target.pause(),this.target.seekTime(0),this.ref.nativeElement.src=this.vgDash)},t.prototype.setBitrate=function(t){var e,i,s=t.mediaType,r=t.qualityIndex;if(this.dash)if(r>0){this.dash.getSettings()&&this.dash.updateSettings({streaming:{abr:{autoSwitchBitrate:(e={},e[s]=!1,e)}}});var a=r-1;this.dash.setQualityFor(s,a)}else this.dash.updateSettings({streaming:{abr:{autoSwitchBitrate:(i={},i[s]=!0,i)}}})},t.prototype.destroyPlayer=function(){this.dash&&(this.dash.reset(),this.dash=null)},t.prototype.ngOnDestroy=function(){this.subscriptions.forEach((function(t){return t.unsubscribe()})),this.destroyPlayer()},t}();r.decorators=[{type:e.Directive,args:[{selector:"[vgDash]",exportAs:"vgDash"}]}],r.ctorParameters=function(){return[{type:e.ElementRef},{type:s.VgApiService}]},r.propDecorators={vgDash:[{type:e.Input}],vgDRMToken:[{type:e.Input}],vgDRMLicenseServer:[{type:e.Input}],onGetBitrates:[{type:e.Output}]};Object.create;function a(t){var e="function"==typeof Symbol&&Symbol.iterator,i=e&&t[e],s=0;if(i)return i.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&s>=t.length&&(t=void 0),{value:t&&t[s++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}Object.create;var n=function(){function t(t,i){this.ref=t,this.API=i,this.vgHlsHeaders={},this.onGetBitrates=new e.EventEmitter,this.subscriptions=[]}return t.prototype.ngOnInit=function(){var t=this;this.API.isPlayerReady?this.onPlayerReady():this.subscriptions.push(this.API.playerReadyEvent.subscribe((function(){return t.onPlayerReady()})))},t.prototype.onPlayerReady=function(){var t=this;this.crossorigin=this.ref.nativeElement.getAttribute("crossorigin"),this.preload="none"!==this.ref.nativeElement.getAttribute("preload"),this.vgFor=this.ref.nativeElement.getAttribute("vgFor"),this.vgFor?this.target=this.API.getMediaById(this.vgFor):this.target=this.API.getDefaultMedia(),this.config={autoStartLoad:this.preload},this.config.xhrSetup=function(e){var i,s;"use-credentials"===t.crossorigin&&(e.withCredentials=!0);try{for(var r=a(Object.keys(t.vgHlsHeaders)),n=r.next();!n.done;n=r.next()){var o=n.value;e.setRequestHeader(o,t.vgHlsHeaders[o])}}catch(t){i={error:t}}finally{try{n&&!n.done&&(s=r.return)&&s.call(r)}finally{if(i)throw i.error}}},this.createPlayer(),this.preload||this.subscriptions.push(this.API.subscriptions.play.subscribe((function(){t.hls&&t.hls.startLoad(0)})))},t.prototype.ngOnChanges=function(t){var e;(null===(e=t.vgHls)||void 0===e?void 0:e.currentValue)?this.createPlayer():t.vgHlsHeaders&&t.vgHlsHeaders.currentValue||this.destroyPlayer()},t.prototype.createPlayer=function(){var t=this;if(this.hls&&this.destroyPlayer(),this.vgHls&&this.vgHls.indexOf("m3u8")>-1&&Hls.isSupported()&&this.API.isPlayerReady){var e=this.ref.nativeElement;this.hls=new Hls(this.config),this.hls.on(Hls.Events.MANIFEST_PARSED,(function(e,i){var s=[];s.push({qualityIndex:0,width:0,height:0,bitrate:0,mediaType:"video",label:"AUTO"}),i.levels.forEach((function(t,e){s.push({qualityIndex:++e,width:t.width,height:t.height,bitrate:t.bitrate,mediaType:"video",label:t.name})})),t.onGetBitrates.emit(s)})),this.hls.on(Hls.Events.LEVEL_LOADED,(function(e,i){t.target.isLive=i.details.live})),this.hls.loadSource(this.vgHls),this.hls.attachMedia(e)}else this.target&&this.target.pause&&(this.target.pause(),this.target.seekTime(0),this.ref.nativeElement.src=this.vgHls)},t.prototype.setBitrate=function(t){this.hls&&(this.hls.nextLevel=t.qualityIndex-1)},t.prototype.destroyPlayer=function(){this.hls&&(this.hls.destroy(),this.hls=null)},t.prototype.ngOnDestroy=function(){this.subscriptions.forEach((function(t){return t.unsubscribe()})),this.destroyPlayer(),delete this.hls},t}();n.decorators=[{type:e.Directive,args:[{selector:"[vgHls]",exportAs:"vgHls"}]}],n.ctorParameters=function(){return[{type:e.ElementRef},{type:s.VgApiService}]},n.propDecorators={vgHls:[{type:e.Input}],vgHlsHeaders:[{type:e.Input}],onGetBitrates:[{type:e.Output}]};var o=function(){};o.decorators=[{type:e.NgModule,args:[{imports:[i.CommonModule,s.VgCoreModule],declarations:[r,n],exports:[r,n]}]}],t.VgDashDirective=r,t.VgHlsDirective=n,t.VgStreamingModule=o,Object.defineProperty(t,"__esModule",{value:!0})}));
//# sourceMappingURL=videogular-ngx-videogular-streaming.umd.min.js.map